<!DOCTYPE HTML>
<html>
<head>
  <title>Diploma Santé - Favoris</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
  <link rel="stylesheet" href="assets/css/main.css" />
  <link rel="icon" type="image/jpeg" href="images/diploma.jpeg" />
  <script src="security.js" defer></script>
</head>
<body class="is-preload">
  <div id="wrapper">
    <div id="main">
      <div class="inner">
        <header id="header">
          <a href="index.html" class="logo"><strong>Diploma Santé</strong>- Plateforme de Flashcards</a>
          <ul class="icons">
            <li><a href="https://diploma-sante.fr/" class="icon fas fa-globe"><span class="label"></span></a></li>
            <li><a href="https://www.instagram.com/diplomasante/" class="icon brands fa-instagram"><span class="label">Instagram</span></a></li>
            <li><a href="#" id="dark-mode-toggle" class="icon fas fa-moon"></a></li>
          </ul>
        </header>

        <section>
          <header class="main">
            <h1>Flashcards favorites</h1>
          </header>

          <div class="progress-container">
            <div class="progress-bar" id="progressBar"></div>
          </div>
          <div class="flashcards-container" id="flashcards"></div>
          <p style="text-align:center"><button id="reset" class="button small">Réinitialiser</button></p>
        </section>
      </div>
    </div>
    <div id="sidebar">
      <div class="inner">
        <!-- Menu copied from index -->
        <section id="search" class="alt">
          <form method="post" action="#">
            <input type="text" name="query" id="query" placeholder="Rechercher">
          </form>
        </section>
        <nav id="menu">
          <header class="major">
            <h2>Menu</h2>
          </header>
          <ul>
            <li><a href="index.html">Accueil</a></li>
            <li><a href="favorites.html">Favoris</a></li>
          </ul>
        </nav>
        <footer id="footer">
          <p class="copyright">&copy; Diploma Santé. Tous droits réservés.</p>
        </footer>
      </div>
    </div>
  </div>

  <script src="assets/js/jquery.min.js"></script>
  <script src="assets/js/browser.min.js"></script>
  <script src="assets/js/breakpoints.min.js"></script>
  <script src="assets/js/util.js"></script>
  <script src="assets/js/main.js"></script>
  <script src="assets/js/darkmode.js"></script>
<script src="assets/js/favorites.js"></script>
    const flashcardsData = getFavorites();
    const container = document.getElementById('flashcards');
    const progressBar = document.getElementById('progressBar');
    const originalData = [...flashcardsData];
    let flashcards = [...originalData];
    let currentIndex = 0;

    function updateProgress() {
      const total = originalData.length;
      const progress = Math.min(currentIndex / total, 1);
      progressBar.style.width = `${progress * 100}%`;
    }

    function createContent(content) {
      if (typeof content === 'string') {
        const div = document.createElement('div');
        div.textContent = content;
        return div;
      }
      if (typeof content === 'object' && content.type === 'image') {
        const wrapper = document.createElement('div');
        wrapper.style.textAlign = 'center';
        if (content.caption) {
          const caption = document.createElement('div');
          caption.textContent = content.caption;
          caption.style.marginBottom = '6px';
          caption.style.fontStyle = 'italic';
          caption.style.fontSize = '0.9em';
          wrapper.appendChild(caption);
        }
        const img = document.createElement('img');
        img.src = content.src;
        img.alt = content.alt || '';
        img.style.maxWidth = '100%';
        img.style.height = 'auto';
        wrapper.appendChild(img);
        return wrapper;
      }
      return document.createElement('div');
    }

    function showCard(index) {
      container.innerHTML = '';
      if (flashcards[index]) {
        const { question, answer } = flashcards[index];
        const card = document.createElement('div');
        card.classList.add('flashcard', 'show');
        const inner = document.createElement('div');
        inner.classList.add('flashcard-inner');
        const front = document.createElement('div');
        front.classList.add('flashcard-front');
        front.appendChild(createContent(question));
        const back = document.createElement('div');
        back.classList.add('flashcard-back');
        back.appendChild(createContent(answer));
        const btnContainer = document.createElement('div');
        btnContainer.classList.add('flashcard-button');
        const toggleBtn = document.createElement('button');
        toggleBtn.classList.add('button', 'large');
        toggleBtn.textContent = 'Voir la réponse';
        btnContainer.appendChild(toggleBtn);
        const checkIcon = document.createElement('span');
        checkIcon.classList.add('check-icon');
        checkIcon.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" stroke="#888" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12" /></svg>';
        checkIcon.addEventListener('click', (e) => {
          e.stopPropagation();
          card.classList.add('slide-right');
          setTimeout(() => {
            currentIndex++;
            updateProgress();
            showCard(currentIndex);
          }, 400);
        });
        const crossIcon = document.createElement('span');
        crossIcon.classList.add('cross-icon');
        crossIcon.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" stroke="#888" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><line x1="18" y1="6" x2="6" y2="18" /><line x1="6" y1="6" x2="18" y2="18" /></svg>';
        crossIcon.addEventListener('click', (e) => {
          e.stopPropagation();
          card.classList.add('slide-left');
          setTimeout(() => {
            const removed = flashcards.splice(currentIndex, 1)[0];
            flashcards.splice(currentIndex + 5, 0, removed);
            showCard(currentIndex);
          }, 400);
        });
        const favIcon = document.createElement('span');
        favIcon.classList.add('favorite-icon');
        favIcon.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16"><path d="M8 .25l1.938 3.92L14 4.75l-3 2.93L11.875 12 8 10l-3.875 2 1.875-4.32-3-2.93 4.062-.58L8 .25z"/></svg>';
        function updateFav() {
          if (isFavorite({question, answer})) favIcon.classList.add('active');
          else favIcon.classList.remove('active');
        }
        favIcon.addEventListener('click', (e) => {
          e.stopPropagation();
          toggleFavorite({question, answer});
          updateFav();
        });
        updateFav();
        card.addEventListener('click', () => {
          const isAnswerVisible = card.classList.toggle('show-answer');
          toggleBtn.textContent = isAnswerVisible ? 'Cacher la réponse' : 'Voir la réponse';
        });
        inner.appendChild(front);
        inner.appendChild(back);
        card.appendChild(inner);
        card.appendChild(btnContainer);
        card.appendChild(checkIcon);
        card.appendChild(crossIcon);
        card.appendChild(favIcon);
        container.appendChild(card);
      } else {
        container.innerHTML = '<p>Plus de flashcards disponibles.</p>';
      }
    }

    document.getElementById('reset').addEventListener('click', () => {
      flashcards = [...originalData];
      currentIndex = 0;
      updateProgress();
      showCard(currentIndex);
    });

    showCard(currentIndex);
    updateProgress();
  </script>
</body>
</html>
